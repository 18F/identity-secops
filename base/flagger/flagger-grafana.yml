---
# Source: grafana/templates/dashboards-cfg.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
data:
  appmesh.json: |-
    {
      "annotations": {
        "list": [
          {
            "builtIn": 1,
            "datasource": "-- Grafana --",
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "type": "dashboard"
          }
        ]
      },
      "editable": true,
      "gnetId": null,
      "graphTooltip": 0,
      "id": 2,
      "iteration": 1553160305729,
      "links": [],
      "panels": [
        {
          "content": "<div class=\"dashboard-header text-center\">\n<span>RED: $canary.$namespace</span>\n</div>",
          "gridPos": {
            "h": 3,
            "w": 24,
            "x": 0,
            "y": 0
          },
          "id": 89,
          "links": [],
          "mode": "html",
          "title": "",
          "transparent": true,
          "type": "text"
        },
        {
          "cacheTimeout": null,
          "colorBackground": false,
          "colorValue": false,
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "datasource": "prometheus",
          "format": "ops",
          "gauge": {
            "maxValue": 100,
            "minValue": 0,
            "show": false,
            "thresholdLabels": false,
            "thresholdMarkers": true
          },
          "gridPos": {
            "h": 4,
            "w": 6,
            "x": 0,
            "y": 3
          },
          "id": 90,
          "interval": null,
          "links": [],
          "mappingType": 1,
          "mappingTypes": [
            {
              "name": "value to text",
              "value": 1
            },
            {
              "name": "range to text",
              "value": 2
            }
          ],
          "maxDataPoints": 100,
          "nullPointMode": "connected",
          "nullText": null,
          "postfix": "",
          "postfixFontSize": "50%",
          "prefix": "",
          "prefixFontSize": "50%",
          "rangeMaps": [
            {
              "from": "null",
              "text": "N/A",
              "to": "null"
            }
          ],
          "sparkline": {
            "fillColor": "rgba(31, 118, 189, 0.18)",
            "full": true,
            "lineColor": "rgb(31, 120, 193)",
            "show": true
          },
          "tableColumn": "",
          "targets": [
            {
              "expr": "round(sum(rate(envoy_cluster_upstream_rq{kubernetes_namespace=~\"$namespace\",app=~\"$primary\"}[30s])), 0.001)",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "",
              "refId": "A",
              "step": 4
            }
          ],
          "thresholds": "",
          "title": "Primary: Incoming Request Volume",
          "transparent": false,
          "type": "singlestat",
          "valueFontSize": "80%",
          "valueMaps": [
            {
              "op": "=",
              "text": "N/A",
              "value": "null"
            }
          ],
          "valueName": "current"
        },
        {
          "cacheTimeout": null,
          "colorBackground": false,
          "colorValue": false,
          "colors": [
            "rgba(50, 172, 45, 0.97)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(245, 54, 54, 0.9)"
          ],
          "datasource": "prometheus",
          "decimals": null,
          "format": "percentunit",
          "gauge": {
            "maxValue": 100,
            "minValue": 80,
            "show": false,
            "thresholdLabels": false,
            "thresholdMarkers": false
          },
          "gridPos": {
            "h": 4,
            "w": 6,
            "x": 6,
            "y": 3
          },
          "id": 98,
          "interval": null,
          "links": [],
          "mappingType": 1,
          "mappingTypes": [
            {
              "name": "value to text",
              "value": 1
            },
            {
              "name": "range to text",
              "value": 2
            }
          ],
          "maxDataPoints": 100,
          "nullPointMode": "connected",
          "nullText": null,
          "postfix": "",
          "postfixFontSize": "50%",
          "prefix": "",
          "prefixFontSize": "50%",
          "rangeMaps": [
            {
              "from": "null",
              "text": "N/A",
              "to": "null"
            }
          ],
          "sparkline": {
            "fillColor": "rgba(31, 118, 189, 0.18)",
            "full": true,
            "lineColor": "rgb(31, 120, 193)",
            "show": true
          },
          "tableColumn": "",
          "targets": [
            {
              "expr": "sum(irate(envoy_cluster_upstream_rq{kubernetes_namespace=~\"$namespace\",app=~\"$primary\",envoy_response_code!~\"5.*\"}[30s])) / sum(irate(envoy_cluster_upstream_rq{kubernetes_namespace=~\"$namespace\",app=~\"$primary\"}[30s]))",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "",
              "refId": "B"
            }
          ],
          "thresholds": "95, 99, 99.5",
          "title": "Incoming Success Rate",
          "transparent": false,
          "type": "singlestat",
          "valueFontSize": "80%",
          "valueMaps": [
            {
              "op": "=",
              "text": "N/A",
              "value": "null"
            }
          ],
          "valueName": "avg"
        },
        {
          "cacheTimeout": null,
          "colorBackground": false,
          "colorValue": false,
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "datasource": "prometheus",
          "format": "ops",
          "gauge": {
            "maxValue": 100,
            "minValue": 0,
            "show": false,
            "thresholdLabels": false,
            "thresholdMarkers": true
          },
          "gridPos": {
            "h": 4,
            "w": 6,
            "x": 12,
            "y": 3
          },
          "id": 97,
          "interval": null,
          "links": [],
          "mappingType": 1,
          "mappingTypes": [
            {
              "name": "value to text",
              "value": 1
            },
            {
              "name": "range to text",
              "value": 2
            }
          ],
          "maxDataPoints": 100,
          "nullPointMode": "connected",
          "nullText": null,
          "postfix": "",
          "postfixFontSize": "50%",
          "prefix": "",
          "prefixFontSize": "50%",
          "rangeMaps": [
            {
              "from": "null",
              "text": "N/A",
              "to": "null"
            }
          ],
          "sparkline": {
            "fillColor": "rgba(40, 224, 65, 0.18)",
            "full": true,
            "lineColor": "#7eb26d",
            "show": true
          },
          "tableColumn": "",
          "targets": [
            {
              "expr": "round(sum(rate(envoy_cluster_upstream_rq{kubernetes_namespace=~\"$namespace\",app=~\"$canary\"}[30s])), 0.001)",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "",
              "refId": "A",
              "step": 4
            }
          ],
          "thresholds": "",
          "title": "Canary: Incoming Request Volume",
          "transparent": false,
          "type": "singlestat",
          "valueFontSize": "80%",
          "valueMaps": [
            {
              "op": "=",
              "text": "N/A",
              "value": "null"
            }
          ],
          "valueName": "current"
        },
        {
          "cacheTimeout": null,
          "colorBackground": false,
          "colorValue": false,
          "colors": [
            "rgba(50, 172, 45, 0.97)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(245, 54, 54, 0.9)"
          ],
          "datasource": "prometheus",
          "decimals": null,
          "format": "percentunit",
          "gauge": {
            "maxValue": 100,
            "minValue": 80,
            "show": false,
            "thresholdLabels": false,
            "thresholdMarkers": false
          },
          "gridPos": {
            "h": 4,
            "w": 6,
            "x": 18,
            "y": 3
          },
          "id": 99,
          "interval": null,
          "links": [],
          "mappingType": 1,
          "mappingTypes": [
            {
              "name": "value to text",
              "value": 1
            },
            {
              "name": "range to text",
              "value": 2
            }
          ],
          "maxDataPoints": 100,
          "nullPointMode": "connected",
          "nullText": null,
          "postfix": "",
          "postfixFontSize": "50%",
          "prefix": "",
          "prefixFontSize": "50%",
          "rangeMaps": [
            {
              "from": "null",
              "text": "N/A",
              "to": "null"
            }
          ],
          "sparkline": {
            "fillColor": "rgba(40, 224, 65, 0.18)",
            "full": true,
            "lineColor": "#7eb26d",
            "show": true
          },
          "tableColumn": "",
          "targets": [
            {
              "expr": "sum(irate(envoy_cluster_upstream_rq{kubernetes_namespace=~\"$namespace\",app=~\"$canary\",envoy_response_code!~\"5.*\"}[30s])) / sum(irate(envoy_cluster_upstream_rq{kubernetes_namespace=~\"$namespace\",app=~\"$canary\"}[30s]))",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "",
              "refId": "B"
            }
          ],
          "thresholds": "95, 99, 99.5",
          "title": "Incoming Success Rate",
          "transparent": false,
          "type": "singlestat",
          "valueFontSize": "80%",
          "valueMaps": [
            {
              "op": "=",
              "text": "N/A",
              "value": "null"
            }
          ],
          "valueName": "current"
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "prometheus",
          "fill": 1,
          "gridPos": {
            "h": 4,
            "w": 12,
            "x": 0,
            "y": 7
          },
          "id": 96,
          "legend": {
            "alignAsTable": false,
            "avg": false,
            "current": false,
            "hideEmpty": false,
            "hideZero": false,
            "max": false,
            "min": false,
            "rightSide": true,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null",
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "(sum(rate(envoy_cluster_upstream_cx_rx_bytes_total{kubernetes_namespace=~\"$namespace\",app=~\"$primary\"}[30s])))",
              "format": "time_series",
              "interval": "",
              "intervalFactor": 1,
              "legendFormat": "traffic",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Primary: Incoming Traffic",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "Bps",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "prometheus",
          "fill": 1,
          "gridPos": {
            "h": 4,
            "w": 12,
            "x": 12,
            "y": 7
          },
          "id": 91,
          "legend": {
            "alignAsTable": false,
            "avg": false,
            "current": false,
            "hideEmpty": false,
            "hideZero": false,
            "max": false,
            "min": false,
            "rightSide": true,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null",
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "(sum(rate(envoy_cluster_upstream_cx_rx_bytes_total{kubernetes_namespace=~\"$namespace\",app=~\"$canary\"}[30s])))",
              "format": "time_series",
              "interval": "",
              "intervalFactor": 1,
              "legendFormat": "traffic",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Canary: Incoming Traffic",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "Bps",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "content": "<div class=\"dashboard-header text-center\">\n<span>USE: $canary.$namespace</span>\n</div>",
          "gridPos": {
            "h": 3,
            "w": 24,
            "x": 0,
            "y": 11
          },
          "id": 101,
          "links": [],
          "mode": "html",
          "title": "",
          "transparent": true,
          "type": "text"
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "prometheus",
          "fill": 1,
          "gridPos": {
            "h": 6,
            "w": 12,
            "x": 0,
            "y": 14
          },
          "id": 100,
          "legend": {
            "alignAsTable": false,
            "avg": false,
            "current": false,
            "hideEmpty": false,
            "hideZero": false,
            "max": false,
            "min": false,
            "rightSide": false,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null",
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": true,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum(rate(container_cpu_usage_seconds_total{cpu=\"total\",namespace=\"$namespace\",pod_name=~\"$primary.*\", container_name!~\"POD|istio-proxy\"}[1m])) by (pod_name)",
              "format": "time_series",
              "hide": false,
              "intervalFactor": 1,
              "legendFormat": "{{ pod_name }}",
              "refId": "B"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Primary: CPU Usage by Pod",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "s",
              "label": "CPU seconds / second",
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "prometheus",
          "fill": 1,
          "gridPos": {
            "h": 6,
            "w": 12,
            "x": 12,
            "y": 14
          },
          "id": 102,
          "legend": {
            "alignAsTable": false,
            "avg": false,
            "current": false,
            "hideEmpty": false,
            "hideZero": false,
            "max": false,
            "min": false,
            "rightSide": false,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null",
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": true,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum(rate(container_cpu_usage_seconds_total{cpu=\"total\",namespace=\"$namespace\",pod_name=~\"$canary.*\", pod_name!~\"$primary.*\", container_name!~\"POD|istio-proxy\"}[1m])) by (pod_name)",
              "format": "time_series",
              "hide": false,
              "intervalFactor": 1,
              "legendFormat": "{{ pod_name }}",
              "refId": "B"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Canary: CPU Usage by Pod",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "s",
              "label": "CPU seconds / second",
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "prometheus",
          "fill": 1,
          "gridPos": {
            "h": 6,
            "w": 12,
            "x": 0,
            "y": 20
          },
          "id": 103,
          "legend": {
            "alignAsTable": false,
            "avg": false,
            "current": false,
            "hideEmpty": false,
            "hideZero": false,
            "max": false,
            "min": false,
            "rightSide": false,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null",
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": true,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum(container_memory_working_set_bytes{namespace=\"$namespace\",pod_name=~\"$primary.*\", container_name!~\"POD|istio-proxy\"}) by (pod_name)",
              "format": "time_series",
              "hide": false,
              "interval": "",
              "intervalFactor": 1,
              "legendFormat": "{{ pod_name }}",
              "refId": "B"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Primary: Memory Usage by Pod",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "decimals": null,
              "format": "bytes",
              "label": "",
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "prometheus",
          "fill": 1,
          "gridPos": {
            "h": 6,
            "w": 12,
            "x": 12,
            "y": 20
          },
          "id": 104,
          "legend": {
            "alignAsTable": false,
            "avg": false,
            "current": false,
            "hideEmpty": false,
            "hideZero": false,
            "max": false,
            "min": false,
            "rightSide": false,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null",
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": true,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum(container_memory_working_set_bytes{namespace=\"$namespace\",pod_name=~\"$canary.*\", pod_name!~\"$primary.*\", container_name!~\"POD|istio-proxy\"}) by (pod_name)",
              "format": "time_series",
              "hide": false,
              "interval": "",
              "intervalFactor": 1,
              "legendFormat": "{{ pod_name }}",
              "refId": "B"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Canary: Memory Usage by Pod",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "decimals": null,
              "format": "bytes",
              "label": "",
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "prometheus",
          "fill": 1,
          "gridPos": {
            "h": 6,
            "w": 12,
            "x": 0,
            "y": 26
          },
          "id": 105,
          "legend": {
            "alignAsTable": false,
            "avg": false,
            "current": false,
            "hideEmpty": false,
            "hideZero": false,
            "max": false,
            "min": false,
            "rightSide": false,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null",
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [
            {
              "alias": "received",
              "color": "#f9d9f9"
            },
            {
              "alias": "transmited",
              "color": "#f29191"
            }
          ],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum(rate (container_network_receive_bytes_total{namespace=\"$namespace\",pod_name=~\"$primary.*\"}[1m])) ",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "received",
              "refId": "A"
            },
            {
              "expr": "-sum (rate (container_network_transmit_bytes_total{namespace=\"$namespace\",pod_name=~\"$primary.*\"}[1m]))",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "transmited",
              "refId": "B"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Primary: Network I/O",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "decimals": null,
              "format": "Bps",
              "label": "",
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "prometheus",
          "fill": 1,
          "gridPos": {
            "h": 6,
            "w": 12,
            "x": 12,
            "y": 26
          },
          "id": 106,
          "legend": {
            "alignAsTable": false,
            "avg": false,
            "current": false,
            "hideEmpty": false,
            "hideZero": false,
            "max": false,
            "min": false,
            "rightSide": false,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null",
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [
            {
              "alias": "received",
              "color": "#f9d9f9"
            },
            {
              "alias": "transmited",
              "color": "#f29191"
            }
          ],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum(rate (container_network_receive_bytes_total{namespace=\"$namespace\",pod_name=~\"$canary.*\",pod_name!~\"$primary.*\"}[1m])) ",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "received",
              "refId": "A"
            },
            {
              "expr": "-sum (rate (container_network_transmit_bytes_total{namespace=\"$namespace\",pod_name=~\"$canary.*\",pod_name!~\"$primary.*\"}[1m]))",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "transmited",
              "refId": "B"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Canary: Network I/O",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "decimals": null,
              "format": "Bps",
              "label": "",
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        }
      ],
      "refresh": "10s",
      "schemaVersion": 16,
      "style": "dark",
      "tags": [],
      "templating": {
        "list": [
          {
            "allValue": null,
            "current": null,
            "datasource": "prometheus",
            "definition": "query_result(sum(envoy_cluster_upstream_rq) by (kubernetes_namespace))",
            "hide": 0,
            "includeAll": false,
            "label": "Namespace",
            "multi": false,
            "name": "namespace",
            "options": [],
            "query": "query_result(sum(envoy_cluster_upstream_rq) by (kubernetes_namespace))",
            "refresh": 1,
            "regex": "/.*_namespace=\"([^\"]*).*/",
            "skipUrlSync": false,
            "sort": 0,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "allValue": null,
            "current": null,
            "datasource": "prometheus",
            "definition": "query_result(sum(envoy_cluster_upstream_rq{kubernetes_namespace=\"$namespace\",app=~\".*-primary\"}) by (app))",
            "hide": 0,
            "includeAll": false,
            "label": "Primary",
            "multi": false,
            "name": "primary",
            "options": [],
            "query": "query_result(sum(envoy_cluster_upstream_rq{kubernetes_namespace=\"$namespace\",app=~\".*-primary\"}) by (app))",
            "refresh": 1,
            "regex": "/.*app=\"([^\"]*).*/",
            "skipUrlSync": false,
            "sort": 1,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "allValue": null,
            "current": null,
            "datasource": "prometheus",
            "definition": "query_result(sum(envoy_cluster_upstream_rq{kubernetes_namespace=\"$namespace\",app!~\".*-primary\"}) by (app))",
            "hide": 0,
            "includeAll": false,
            "label": "Canary",
            "multi": false,
            "name": "canary",
            "options": [],
            "query": "query_result(sum(envoy_cluster_upstream_rq{kubernetes_namespace=\"$namespace\",app!~\".*-primary\"}) by (app))",
            "refresh": 1,
            "regex": "/.*app=\"([^\"]*).*/",
            "skipUrlSync": false,
            "sort": 1,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          }
        ]
      },
      "time": {
        "from": "now-5m",
        "to": "now"
      },
      "timepicker": {
        "refresh_intervals": [
          "5s",
          "10s",
          "30s",
          "1m",
          "5m",
          "15m",
          "30m",
          "1h",
          "2h",
          "1d"
        ],
        "time_options": [
          "5m",
          "15m",
          "1h",
          "6h",
          "12h",
          "24h",
          "2d",
          "7d",
          "30d"
        ]
      },
      "timezone": "",
      "title": "AppMesh Canary",
      "uid": "flagger-appmesh",
      "version": 4
    }
  envoy.json: |-
    {
      "annotations": {
        "list": [
          {
            "builtIn": 1,
            "datasource": "-- Grafana --",
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "type": "dashboard"
          }
        ]
      },
      "editable": true,
      "gnetId": null,
      "graphTooltip": 0,
      "id": 3,
      "iteration": 1553160305729,
      "links": [],
      "panels": [
        {
          "content": "<div class=\"dashboard-header text-center\">\n<span>RED: $target.$namespace</span>\n</div>",
          "gridPos": {
            "h": 3,
            "w": 24,
            "x": 0,
            "y": 0
          },
          "id": 89,
          "links": [],
          "mode": "html",
          "title": "",
          "transparent": true,
          "type": "text"
        },
        {
          "cacheTimeout": null,
          "colorBackground": false,
          "colorValue": false,
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "datasource": "prometheus",
          "format": "ops",
          "gauge": {
            "maxValue": 100,
            "minValue": 0,
            "show": false,
            "thresholdLabels": false,
            "thresholdMarkers": true
          },
          "gridPos": {
            "h": 4,
            "w": 6,
            "x": 0,
            "y": 3
          },
          "id": 90,
          "interval": null,
          "links": [],
          "mappingType": 1,
          "mappingTypes": [
            {
              "name": "value to text",
              "value": 1
            },
            {
              "name": "range to text",
              "value": 2
            }
          ],
          "maxDataPoints": 100,
          "nullPointMode": "connected",
          "nullText": null,
          "postfix": "",
          "postfixFontSize": "50%",
          "prefix": "",
          "prefixFontSize": "50%",
          "rangeMaps": [
            {
              "from": "null",
              "text": "N/A",
              "to": "null"
            }
          ],
          "sparkline": {
            "fillColor": "rgba(31, 118, 189, 0.18)",
            "full": true,
            "lineColor": "rgb(31, 120, 193)",
            "show": true
          },
          "tableColumn": "",
          "targets": [
            {
              "expr": "round(sum(rate(envoy_cluster_upstream_rq{kubernetes_namespace=~\"$namespace\",envoy_cluster_name=~\"$target-primary\"}[30s])), 0.001)",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "",
              "refId": "A",
              "step": 4
            }
          ],
          "thresholds": "",
          "title": "Primary: Incoming Request Volume",
          "transparent": false,
          "type": "singlestat",
          "valueFontSize": "80%",
          "valueMaps": [
            {
              "op": "=",
              "text": "N/A",
              "value": "null"
            }
          ],
          "valueName": "current"
        },
        {
          "cacheTimeout": null,
          "colorBackground": false,
          "colorValue": false,
          "colors": [
            "rgba(50, 172, 45, 0.97)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(245, 54, 54, 0.9)"
          ],
          "datasource": "prometheus",
          "decimals": null,
          "format": "percentunit",
          "gauge": {
            "maxValue": 100,
            "minValue": 80,
            "show": false,
            "thresholdLabels": false,
            "thresholdMarkers": false
          },
          "gridPos": {
            "h": 4,
            "w": 6,
            "x": 6,
            "y": 3
          },
          "id": 98,
          "interval": null,
          "links": [],
          "mappingType": 1,
          "mappingTypes": [
            {
              "name": "value to text",
              "value": 1
            },
            {
              "name": "range to text",
              "value": 2
            }
          ],
          "maxDataPoints": 100,
          "nullPointMode": "connected",
          "nullText": null,
          "postfix": "",
          "postfixFontSize": "50%",
          "prefix": "",
          "prefixFontSize": "50%",
          "rangeMaps": [
            {
              "from": "null",
              "text": "N/A",
              "to": "null"
            }
          ],
          "sparkline": {
            "fillColor": "rgba(31, 118, 189, 0.18)",
            "full": true,
            "lineColor": "rgb(31, 120, 193)",
            "show": true
          },
          "tableColumn": "",
          "targets": [
            {
              "expr": "sum(irate(envoy_cluster_upstream_rq{kubernetes_namespace=~\"$namespace\",envoy_cluster_name=~\"$target-primary\",envoy_response_code!~\"5.*\"}[30s])) / sum(irate(envoy_cluster_upstream_rq{kubernetes_namespace=~\"$namespace\",envoy_cluster_name=~\"$target-primary\"}[30s]))",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "",
              "refId": "B"
            }
          ],
          "thresholds": "95, 99, 99.5",
          "title": "Incoming Success Rate",
          "transparent": false,
          "type": "singlestat",
          "valueFontSize": "80%",
          "valueMaps": [
            {
              "op": "=",
              "text": "N/A",
              "value": "null"
            }
          ],
          "valueName": "avg"
        },
        {
          "cacheTimeout": null,
          "colorBackground": false,
          "colorValue": false,
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "datasource": "prometheus",
          "format": "ops",
          "gauge": {
            "maxValue": 100,
            "minValue": 0,
            "show": false,
            "thresholdLabels": false,
            "thresholdMarkers": true
          },
          "gridPos": {
            "h": 4,
            "w": 6,
            "x": 12,
            "y": 3
          },
          "id": 97,
          "interval": null,
          "links": [],
          "mappingType": 1,
          "mappingTypes": [
            {
              "name": "value to text",
              "value": 1
            },
            {
              "name": "range to text",
              "value": 2
            }
          ],
          "maxDataPoints": 100,
          "nullPointMode": "connected",
          "nullText": null,
          "postfix": "",
          "postfixFontSize": "50%",
          "prefix": "",
          "prefixFontSize": "50%",
          "rangeMaps": [
            {
              "from": "null",
              "text": "N/A",
              "to": "null"
            }
          ],
          "sparkline": {
            "fillColor": "rgba(40, 224, 65, 0.18)",
            "full": true,
            "lineColor": "#7eb26d",
            "show": true
          },
          "tableColumn": "",
          "targets": [
            {
              "expr": "round(sum(rate(envoy_cluster_upstream_rq{kubernetes_namespace=~\"$namespace\",envoy_cluster_name=~\"$target-canary\"}[30s])), 0.001)",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "",
              "refId": "A",
              "step": 4
            }
          ],
          "thresholds": "",
          "title": "Canary: Incoming Request Volume",
          "transparent": false,
          "type": "singlestat",
          "valueFontSize": "80%",
          "valueMaps": [
            {
              "op": "=",
              "text": "N/A",
              "value": "null"
            }
          ],
          "valueName": "current"
        },
        {
          "cacheTimeout": null,
          "colorBackground": false,
          "colorValue": false,
          "colors": [
            "rgba(50, 172, 45, 0.97)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(245, 54, 54, 0.9)"
          ],
          "datasource": "prometheus",
          "decimals": null,
          "format": "percentunit",
          "gauge": {
            "maxValue": 100,
            "minValue": 80,
            "show": false,
            "thresholdLabels": false,
            "thresholdMarkers": false
          },
          "gridPos": {
            "h": 4,
            "w": 6,
            "x": 18,
            "y": 3
          },
          "id": 99,
          "interval": null,
          "links": [],
          "mappingType": 1,
          "mappingTypes": [
            {
              "name": "value to text",
              "value": 1
            },
            {
              "name": "range to text",
              "value": 2
            }
          ],
          "maxDataPoints": 100,
          "nullPointMode": "connected",
          "nullText": null,
          "postfix": "",
          "postfixFontSize": "50%",
          "prefix": "",
          "prefixFontSize": "50%",
          "rangeMaps": [
            {
              "from": "null",
              "text": "N/A",
              "to": "null"
            }
          ],
          "sparkline": {
            "fillColor": "rgba(40, 224, 65, 0.18)",
            "full": true,
            "lineColor": "#7eb26d",
            "show": true
          },
          "tableColumn": "",
          "targets": [
            {
              "expr": "sum(irate(envoy_cluster_upstream_rq{kubernetes_namespace=~\"$namespace\",envoy_cluster_name=~\"$target-canary\",envoy_response_code!~\"5.*\"}[30s])) / sum(irate(envoy_cluster_upstream_rq{kubernetes_namespace=~\"$namespace\",envoy_cluster_name=~\"$target-canary\"}[30s]))",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "",
              "refId": "B"
            }
          ],
          "thresholds": "95, 99, 99.5",
          "title": "Incoming Success Rate",
          "transparent": false,
          "type": "singlestat",
          "valueFontSize": "80%",
          "valueMaps": [
            {
              "op": "=",
              "text": "N/A",
              "value": "null"
            }
          ],
          "valueName": "current"
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "prometheus",
          "fill": 1,
          "gridPos": {
            "h": 4,
            "w": 12,
            "x": 0,
            "y": 7
          },
          "id": 96,
          "legend": {
            "alignAsTable": false,
            "avg": false,
            "current": false,
            "hideEmpty": false,
            "hideZero": false,
            "max": false,
            "min": false,
            "rightSide": true,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null",
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "(sum(rate(envoy_cluster_upstream_cx_rx_bytes_total{kubernetes_namespace=~\"$namespace\",envoy_cluster_name=~\"$target-primary\"}[30s])))",
              "format": "time_series",
              "interval": "",
              "intervalFactor": 1,
              "legendFormat": "traffic",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Primary: Incoming Traffic",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "Bps",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "prometheus",
          "fill": 1,
          "gridPos": {
            "h": 4,
            "w": 12,
            "x": 12,
            "y": 7
          },
          "id": 91,
          "legend": {
            "alignAsTable": false,
            "avg": false,
            "current": false,
            "hideEmpty": false,
            "hideZero": false,
            "max": false,
            "min": false,
            "rightSide": true,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null",
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "(sum(rate(envoy_cluster_upstream_cx_rx_bytes_total{kubernetes_namespace=~\"$namespace\",envoy_cluster_name=~\"$target-canary\"}[30s])))",
              "format": "time_series",
              "interval": "",
              "intervalFactor": 1,
              "legendFormat": "traffic",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Canary: Incoming Traffic",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "Bps",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "content": "<div class=\"dashboard-header text-center\">\n<span>USE: $target.$namespace</span>\n</div>",
          "gridPos": {
            "h": 3,
            "w": 24,
            "x": 0,
            "y": 11
          },
          "id": 101,
          "links": [],
          "mode": "html",
          "title": "",
          "transparent": true,
          "type": "text"
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "prometheus",
          "fill": 1,
          "gridPos": {
            "h": 6,
            "w": 12,
            "x": 0,
            "y": 14
          },
          "id": 100,
          "legend": {
            "alignAsTable": false,
            "avg": false,
            "current": false,
            "hideEmpty": false,
            "hideZero": false,
            "max": false,
            "min": false,
            "rightSide": false,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null",
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": true,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum(rate(container_cpu_usage_seconds_total{cpu=\"total\",namespace=\"$namespace\",pod_name=~\"$target-primary.*\", container_name!~\"POD|istio-proxy\"}[1m])) by (pod_name)",
              "format": "time_series",
              "hide": false,
              "intervalFactor": 1,
              "legendFormat": "{{ pod_name }}",
              "refId": "B"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Primary: CPU Usage by Pod",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "s",
              "label": "CPU seconds / second",
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "prometheus",
          "fill": 1,
          "gridPos": {
            "h": 6,
            "w": 12,
            "x": 12,
            "y": 14
          },
          "id": 102,
          "legend": {
            "alignAsTable": false,
            "avg": false,
            "current": false,
            "hideEmpty": false,
            "hideZero": false,
            "max": false,
            "min": false,
            "rightSide": false,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null",
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": true,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum(rate(container_cpu_usage_seconds_total{cpu=\"total\",namespace=\"$namespace\",pod_name=~\"$target.*\", pod_name!~\"$target-primary.*\", container_name!~\"POD|istio-proxy\"}[1m])) by (pod_name)",
              "format": "time_series",
              "hide": false,
              "intervalFactor": 1,
              "legendFormat": "{{ pod_name }}",
              "refId": "B"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Canary: CPU Usage by Pod",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "s",
              "label": "CPU seconds / second",
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "prometheus",
          "fill": 1,
          "gridPos": {
            "h": 6,
            "w": 12,
            "x": 0,
            "y": 20
          },
          "id": 103,
          "legend": {
            "alignAsTable": false,
            "avg": false,
            "current": false,
            "hideEmpty": false,
            "hideZero": false,
            "max": false,
            "min": false,
            "rightSide": false,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null",
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": true,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum(container_memory_working_set_bytes{namespace=\"$namespace\",pod_name=~\"$target-primary.*\", container_name!~\"POD|istio-proxy\"}) by (pod_name)",
              "format": "time_series",
              "hide": false,
              "interval": "",
              "intervalFactor": 1,
              "legendFormat": "{{ pod_name }}",
              "refId": "B"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Primary: Memory Usage by Pod",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "decimals": null,
              "format": "bytes",
              "label": "",
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "prometheus",
          "fill": 1,
          "gridPos": {
            "h": 6,
            "w": 12,
            "x": 12,
            "y": 20
          },
          "id": 104,
          "legend": {
            "alignAsTable": false,
            "avg": false,
            "current": false,
            "hideEmpty": false,
            "hideZero": false,
            "max": false,
            "min": false,
            "rightSide": false,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null",
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": true,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum(container_memory_working_set_bytes{namespace=\"$namespace\",pod_name=~\"$target.*\", pod_name!~\"$target-primary.*\", container_name!~\"POD|istio-proxy\"}) by (pod_name)",
              "format": "time_series",
              "hide": false,
              "interval": "",
              "intervalFactor": 1,
              "legendFormat": "{{ pod_name }}",
              "refId": "B"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Canary: Memory Usage by Pod",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "decimals": null,
              "format": "bytes",
              "label": "",
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "prometheus",
          "fill": 1,
          "gridPos": {
            "h": 6,
            "w": 12,
            "x": 0,
            "y": 26
          },
          "id": 105,
          "legend": {
            "alignAsTable": false,
            "avg": false,
            "current": false,
            "hideEmpty": false,
            "hideZero": false,
            "max": false,
            "min": false,
            "rightSide": false,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null",
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [
            {
              "alias": "received",
              "color": "#f9d9f9"
            },
            {
              "alias": "transmited",
              "color": "#f29191"
            }
          ],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum(rate (container_network_receive_bytes_total{namespace=\"$namespace\",pod_name=~\"$target-primary.*\"}[1m])) ",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "received",
              "refId": "A"
            },
            {
              "expr": "-sum (rate (container_network_transmit_bytes_total{namespace=\"$namespace\",pod_name=~\"$target-primary.*\"}[1m]))",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "transmited",
              "refId": "B"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Primary: Network I/O",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "decimals": null,
              "format": "Bps",
              "label": "",
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "prometheus",
          "fill": 1,
          "gridPos": {
            "h": 6,
            "w": 12,
            "x": 12,
            "y": 26
          },
          "id": 106,
          "legend": {
            "alignAsTable": false,
            "avg": false,
            "current": false,
            "hideEmpty": false,
            "hideZero": false,
            "max": false,
            "min": false,
            "rightSide": false,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "links": [],
          "nullPointMode": "null",
          "percentage": false,
          "pointradius": 5,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [
            {
              "alias": "received",
              "color": "#f9d9f9"
            },
            {
              "alias": "transmited",
              "color": "#f29191"
            }
          ],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum(rate (container_network_receive_bytes_total{namespace=\"$namespace\",pod_name=~\"$target.*\",pod_name!~\"$target-primary.*\"}[1m])) ",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "received",
              "refId": "A"
            },
            {
              "expr": "-sum (rate (container_network_transmit_bytes_total{namespace=\"$namespace\",pod_name=~\"$target.*\",pod_name!~\"$target-primary.*\"}[1m]))",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "transmited",
              "refId": "B"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Canary: Network I/O",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "graph",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "decimals": null,
              "format": "Bps",
              "label": "",
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        }
      ],
      "refresh": "10s",
      "schemaVersion": 16,
      "style": "dark",
      "tags": [],
      "templating": {
        "list": [
          {
            "allValue": null,
            "current": null,
            "datasource": "prometheus",
            "definition": "query_result(sum(envoy_cluster_upstream_rq) by (kubernetes_namespace))",
            "hide": 0,
            "includeAll": false,
            "label": "Namespace",
            "multi": false,
            "name": "namespace",
            "options": [],
            "query": "query_result(sum(envoy_cluster_upstream_rq) by (kubernetes_namespace))",
            "refresh": 1,
            "regex": "/.*_namespace=\"([^\"]*).*/",
            "skipUrlSync": false,
            "sort": 0,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "allValue": null,
            "current": null,
            "datasource": "prometheus",
            "definition": "query_result(sum(envoy_cluster_upstream_rq{kubernetes_namespace=\"$namespace\",envoy_cluster_name=~\".*-primary\"}) by (envoy_cluster_name))",
            "hide": 0,
            "includeAll": false,
            "label": "Target",
            "multi": false,
            "name": "target",
            "options": [],
            "query": "query_result(sum(envoy_cluster_upstream_rq{kubernetes_namespace=\"$namespace\",envoy_cluster_name=~\".*-primary\"}) by (envoy_cluster_name))",
            "refresh": 1,
            "regex": "/.*envoy_cluster_name=\"(.*)-primary\"/",
            "skipUrlSync": false,
            "sort": 1,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          }
        ]
      },
      "time": {
        "from": "now-5m",
        "to": "now"
      },
      "timepicker": {
        "refresh_intervals": [
          "5s",
          "10s",
          "30s",
          "1m",
          "5m",
          "15m",
          "30m",
          "1h",
          "2h",
          "1d"
        ],
        "time_options": [
          "5m",
          "15m",
          "1h",
          "6h",
          "12h",
          "24h",
          "2d",
          "7d",
          "30d"
        ]
      },
      "timezone": "",
      "title": "Envoy Canary",
      "uid": "flagger-envoy",
      "version": 6
    }
  istio.json: "{\n  \"annotations\": {\n    \"list\": [\n      {\n        \"builtIn\":
    1,\n        \"datasource\": \"-- Grafana --\",\n        \"enable\": true,\n        \"hide\":
    true,\n        \"iconColor\": \"rgba(0, 211, 255, 1)\",\n        \"name\": \"Annotations
    & Alerts\",\n        \"type\": \"dashboard\"\n      }\n    ]\n  },\n  \"editable\":
    true,\n  \"gnetId\": null,\n  \"graphTooltip\": 0,\n  \"id\": 1,\n  \"iteration\":
    1549736611069,\n  \"links\": [],\n  \"panels\": [\n    {\n      \"content\": \"<div
    class=\\\"dashboard-header text-center\\\">\\n<span>RED: $canary.$namespace</span>\\n</div>\",\n
    \     \"gridPos\": {\n        \"h\": 3,\n        \"w\": 24,\n        \"x\": 0,\n
    \       \"y\": 0\n      },\n      \"id\": 89,\n      \"links\": [],\n      \"mode\":
    \"html\",\n      \"title\": \"\",\n      \"transparent\": true,\n      \"type\":
    \"text\"\n    },\n    {\n      \"cacheTimeout\": null,\n      \"colorBackground\":
    false,\n      \"colorValue\": false,\n      \"colors\": [\n        \"rgba(245, 54,
    54, 0.9)\",\n        \"rgba(237, 129, 40, 0.89)\",\n        \"rgba(50, 172, 45,
    0.97)\"\n      ],\n      \"datasource\": \"prometheus\",\n      \"format\": \"ops\",\n
    \     \"gauge\": {\n        \"maxValue\": 100,\n        \"minValue\": 0,\n        \"show\":
    false,\n        \"thresholdLabels\": false,\n        \"thresholdMarkers\": true\n
    \     },\n      \"gridPos\": {\n        \"h\": 4,\n        \"w\": 6,\n        \"x\":
    0,\n        \"y\": 3\n      },\n      \"id\": 90,\n      \"interval\": null,\n      \"links\":
    [],\n      \"mappingType\": 1,\n      \"mappingTypes\": [\n        {\n          \"name\":
    \"value to text\",\n          \"value\": 1\n        },\n        {\n          \"name\":
    \"range to text\",\n          \"value\": 2\n        }\n      ],\n      \"maxDataPoints\":
    100,\n      \"nullPointMode\": \"connected\",\n      \"nullText\": null,\n      \"postfix\":
    \"\",\n      \"postfixFontSize\": \"50%\",\n      \"prefix\": \"\",\n      \"prefixFontSize\":
    \"50%\",\n      \"rangeMaps\": [\n        {\n          \"from\": \"null\",\n          \"text\":
    \"N/A\",\n          \"to\": \"null\"\n        }\n      ],\n      \"sparkline\":
    {\n        \"fillColor\": \"rgba(31, 118, 189, 0.18)\",\n        \"full\": true,\n
    \       \"lineColor\": \"rgb(31, 120, 193)\",\n        \"show\": true\n      },\n
    \     \"tableColumn\": \"\",\n      \"targets\": [\n        {\n          \"expr\":
    \"round(sum(rate(istio_requests_total{reporter=\\\"destination\\\",destination_workload_namespace=~\\\"$namespace\\\",destination_workload=~\\\"$primary\\\"}[30s])),
    0.001)\",\n          \"format\": \"time_series\",\n          \"intervalFactor\":
    1,\n          \"refId\": \"A\",\n          \"step\": 4\n        }\n      ],\n      \"thresholds\":
    \"\",\n      \"title\": \"Primary: Incoming Request Volume\",\n      \"transparent\":
    false,\n      \"type\": \"singlestat\",\n      \"valueFontSize\": \"80%\",\n      \"valueMaps\":
    [\n        {\n          \"op\": \"=\",\n          \"text\": \"N/A\",\n          \"value\":
    \"null\"\n        }\n      ],\n      \"valueName\": \"current\"\n    },\n    {\n
    \     \"cacheTimeout\": null,\n      \"colorBackground\": false,\n      \"colorValue\":
    false,\n      \"colors\": [\n        \"rgba(50, 172, 45, 0.97)\",\n        \"rgba(237,
    129, 40, 0.89)\",\n        \"rgba(245, 54, 54, 0.9)\"\n      ],\n      \"datasource\":
    \"prometheus\",\n      \"decimals\": null,\n      \"format\": \"percentunit\",\n
    \     \"gauge\": {\n        \"maxValue\": 100,\n        \"minValue\": 80,\n        \"show\":
    false,\n        \"thresholdLabels\": false,\n        \"thresholdMarkers\": false\n
    \     },\n      \"gridPos\": {\n        \"h\": 4,\n        \"w\": 6,\n        \"x\":
    6,\n        \"y\": 3\n      },\n      \"id\": 98,\n      \"interval\": null,\n      \"links\":
    [],\n      \"mappingType\": 1,\n      \"mappingTypes\": [\n        {\n          \"name\":
    \"value to text\",\n          \"value\": 1\n        },\n        {\n          \"name\":
    \"range to text\",\n          \"value\": 2\n        }\n      ],\n      \"maxDataPoints\":
    100,\n      \"nullPointMode\": \"connected\",\n      \"nullText\": null,\n      \"postfix\":
    \"\",\n      \"postfixFontSize\": \"50%\",\n      \"prefix\": \"\",\n      \"prefixFontSize\":
    \"50%\",\n      \"rangeMaps\": [\n        {\n          \"from\": \"null\",\n          \"text\":
    \"N/A\",\n          \"to\": \"null\"\n        }\n      ],\n      \"sparkline\":
    {\n        \"fillColor\": \"rgba(31, 118, 189, 0.18)\",\n        \"full\": true,\n
    \       \"lineColor\": \"rgb(31, 120, 193)\",\n        \"show\": true\n      },\n
    \     \"tableColumn\": \"\",\n      \"targets\": [\n        {\n          \"expr\":
    \"sum(irate(istio_requests_total{reporter=\\\"destination\\\",destination_workload_namespace=~\\\"$namespace\\\",destination_workload=~\\\"$primary\\\",response_code!~\\\"5.*\\\"}[30s]))
    / sum(irate(istio_requests_total{reporter=\\\"destination\\\",destination_workload_namespace=~\\\"$namespace\\\",destination_workload=~\\\"$primary\\\"}[30s]))\",\n
    \         \"format\": \"time_series\",\n          \"intervalFactor\": 1,\n          \"refId\":
    \"B\"\n        }\n      ],\n      \"thresholds\": \"95, 99, 99.5\",\n      \"title\":
    \"Incoming Success Rate\",\n      \"transparent\": false,\n      \"type\": \"singlestat\",\n
    \     \"valueFontSize\": \"80%\",\n      \"valueMaps\": [\n        {\n          \"op\":
    \"=\",\n          \"text\": \"N/A\",\n          \"value\": \"null\"\n        }\n
    \     ],\n      \"valueName\": \"avg\"\n    },\n    {\n      \"cacheTimeout\": null,\n
    \     \"colorBackground\": false,\n      \"colorValue\": false,\n      \"colors\":
    [\n        \"rgba(245, 54, 54, 0.9)\",\n        \"rgba(237, 129, 40, 0.89)\",\n
    \       \"rgba(50, 172, 45, 0.97)\"\n      ],\n      \"datasource\": \"prometheus\",\n
    \     \"format\": \"ops\",\n      \"gauge\": {\n        \"maxValue\": 100,\n        \"minValue\":
    0,\n        \"show\": false,\n        \"thresholdLabels\": false,\n        \"thresholdMarkers\":
    true\n      },\n      \"gridPos\": {\n        \"h\": 4,\n        \"w\": 6,\n        \"x\":
    12,\n        \"y\": 3\n      },\n      \"id\": 97,\n      \"interval\": null,\n
    \     \"links\": [],\n      \"mappingType\": 1,\n      \"mappingTypes\": [\n        {\n
    \         \"name\": \"value to text\",\n          \"value\": 1\n        },\n        {\n
    \         \"name\": \"range to text\",\n          \"value\": 2\n        }\n      ],\n
    \     \"maxDataPoints\": 100,\n      \"nullPointMode\": \"connected\",\n      \"nullText\":
    null,\n      \"postfix\": \"\",\n      \"postfixFontSize\": \"50%\",\n      \"prefix\":
    \"\",\n      \"prefixFontSize\": \"50%\",\n      \"rangeMaps\": [\n        {\n          \"from\":
    \"null\",\n          \"text\": \"N/A\",\n          \"to\": \"null\"\n        }\n
    \     ],\n      \"sparkline\": {\n        \"fillColor\": \"rgba(40, 224, 65, 0.18)\",\n
    \       \"full\": true,\n        \"lineColor\": \"#7eb26d\",\n        \"show\":
    true\n      },\n      \"tableColumn\": \"\",\n      \"targets\": [\n        {\n
    \         \"expr\": \"round(sum(rate(istio_requests_total{reporter=\\\"destination\\\",destination_workload_namespace=~\\\"$namespace\\\",destination_workload=~\\\"$canary\\\"}[30s])),
    0.001)\",\n          \"format\": \"time_series\",\n          \"intervalFactor\":
    1,\n          \"refId\": \"A\",\n          \"step\": 4\n        }\n      ],\n      \"thresholds\":
    \"\",\n      \"title\": \"Canary: Incoming Request Volume\",\n      \"transparent\":
    false,\n      \"type\": \"singlestat\",\n      \"valueFontSize\": \"80%\",\n      \"valueMaps\":
    [\n        {\n          \"op\": \"=\",\n          \"text\": \"N/A\",\n          \"value\":
    \"null\"\n        }\n      ],\n      \"valueName\": \"current\"\n    },\n    {\n
    \     \"cacheTimeout\": null,\n      \"colorBackground\": false,\n      \"colorValue\":
    false,\n      \"colors\": [\n        \"rgba(50, 172, 45, 0.97)\",\n        \"rgba(237,
    129, 40, 0.89)\",\n        \"rgba(245, 54, 54, 0.9)\"\n      ],\n      \"datasource\":
    \"prometheus\",\n      \"decimals\": null,\n      \"format\": \"percentunit\",\n
    \     \"gauge\": {\n        \"maxValue\": 100,\n        \"minValue\": 80,\n        \"show\":
    false,\n        \"thresholdLabels\": false,\n        \"thresholdMarkers\": false\n
    \     },\n      \"gridPos\": {\n        \"h\": 4,\n        \"w\": 6,\n        \"x\":
    18,\n        \"y\": 3\n      },\n      \"id\": 99,\n      \"interval\": null,\n
    \     \"links\": [],\n      \"mappingType\": 1,\n      \"mappingTypes\": [\n        {\n
    \         \"name\": \"value to text\",\n          \"value\": 1\n        },\n        {\n
    \         \"name\": \"range to text\",\n          \"value\": 2\n        }\n      ],\n
    \     \"maxDataPoints\": 100,\n      \"nullPointMode\": \"connected\",\n      \"nullText\":
    null,\n      \"postfix\": \"\",\n      \"postfixFontSize\": \"50%\",\n      \"prefix\":
    \"\",\n      \"prefixFontSize\": \"50%\",\n      \"rangeMaps\": [\n        {\n          \"from\":
    \"null\",\n          \"text\": \"N/A\",\n          \"to\": \"null\"\n        }\n
    \     ],\n      \"sparkline\": {\n        \"fillColor\": \"rgba(40, 224, 65, 0.18)\",\n
    \       \"full\": true,\n        \"lineColor\": \"#7eb26d\",\n        \"show\":
    true\n      },\n      \"tableColumn\": \"\",\n      \"targets\": [\n        {\n
    \         \"expr\": \"sum(irate(istio_requests_total{reporter=\\\"destination\\\",destination_workload_namespace=~\\\"$namespace\\\",destination_workload=~\\\"$canary\\\",response_code!~\\\"5.*\\\"}[30s]))
    / sum(irate(istio_requests_total{reporter=\\\"destination\\\",destination_workload_namespace=~\\\"$namespace\\\",destination_workload=~\\\"$canary\\\"}[30s]))\",\n
    \         \"format\": \"time_series\",\n          \"intervalFactor\": 1,\n          \"refId\":
    \"B\"\n        }\n      ],\n      \"thresholds\": \"95, 99, 99.5\",\n      \"title\":
    \"Incoming Success Rate\",\n      \"transparent\": false,\n      \"type\": \"singlestat\",\n
    \     \"valueFontSize\": \"80%\",\n      \"valueMaps\": [\n        {\n          \"op\":
    \"=\",\n          \"text\": \"N/A\",\n          \"value\": \"null\"\n        }\n
    \     ],\n      \"valueName\": \"current\"\n    },\n    {\n      \"aliasColors\":
    {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n
    \     \"datasource\": \"prometheus\",\n      \"fill\": 1,\n      \"gridPos\": {\n
    \       \"h\": 4,\n        \"w\": 12,\n        \"x\": 0,\n        \"y\": 7\n      },\n
    \     \"id\": 96,\n      \"legend\": {\n        \"alignAsTable\": false,\n        \"avg\":
    false,\n        \"current\": false,\n        \"hideEmpty\": false,\n        \"hideZero\":
    false,\n        \"max\": false,\n        \"min\": false,\n        \"rightSide\":
    true,\n        \"show\": false,\n        \"total\": false,\n        \"values\":
    false\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"links\":
    [],\n      \"nullPointMode\": \"null\",\n      \"percentage\": false,\n      \"pointradius\":
    5,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\":
    [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n      \"steppedLine\":
    false,\n      \"targets\": [\n        {\n          \"expr\": \"histogram_quantile(0.50,
    sum(irate(istio_request_duration_seconds_bucket{reporter=\\\"destination\\\",destination_workload=~\\\"$primary\\\",
    destination_workload_namespace=~\\\"$namespace\\\"}[1m])) by (le))\",\n          \"format\":
    \"time_series\",\n          \"interval\": \"\",\n          \"intervalFactor\": 1,\n
    \         \"legendFormat\": \"P50\",\n          \"refId\": \"A\"\n        },\n        {\n
    \         \"expr\": \"histogram_quantile(0.90, sum(irate(istio_request_duration_seconds_bucket{reporter=\\\"destination\\\",destination_workload=~\\\"$primary\\\",
    destination_workload_namespace=~\\\"$namespace\\\"}[1m])) by (le))\",\n          \"format\":
    \"time_series\",\n          \"hide\": false,\n          \"intervalFactor\": 1,\n
    \         \"legendFormat\": \"P90\",\n          \"refId\": \"B\"\n        },\n        {\n
    \         \"expr\": \"histogram_quantile(0.99, sum(irate(istio_request_duration_seconds_bucket{reporter=\\\"destination\\\",destination_workload=~\\\"$primary\\\",
    destination_workload_namespace=~\\\"$namespace\\\"}[1m])) by (le))\",\n          \"format\":
    \"time_series\",\n          \"hide\": false,\n          \"intervalFactor\": 1,\n
    \         \"legendFormat\": \"P99\",\n          \"refId\": \"C\"\n        }\n      ],\n
    \     \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n
    \     \"timeShift\": null,\n      \"title\": \"Primary: Request Duration\",\n      \"tooltip\":
    {\n        \"shared\": true,\n        \"sort\": 0,\n        \"value_type\": \"individual\"\n
    \     },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n
    \       \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n
    \       \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"format\":
    \"s\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\":
    null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n
    \         \"format\": \"short\",\n          \"label\": null,\n          \"logBase\":
    1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": false\n
    \       }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\":
    null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n
    \     \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": \"prometheus\",\n
    \     \"fill\": 1,\n      \"gridPos\": {\n        \"h\": 4,\n        \"w\": 12,\n
    \       \"x\": 12,\n        \"y\": 7\n      },\n      \"id\": 91,\n      \"legend\":
    {\n        \"alignAsTable\": false,\n        \"avg\": false,\n        \"current\":
    false,\n        \"hideEmpty\": false,\n        \"hideZero\": false,\n        \"max\":
    false,\n        \"min\": false,\n        \"rightSide\": true,\n        \"show\":
    false,\n        \"total\": false,\n        \"values\": false\n      },\n      \"lines\":
    true,\n      \"linewidth\": 1,\n      \"links\": [],\n      \"nullPointMode\": \"null\",\n
    \     \"percentage\": false,\n      \"pointradius\": 5,\n      \"points\": false,\n
    \     \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\":
    10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\":
    [\n        {\n          \"expr\": \"histogram_quantile(0.50, sum(irate(istio_request_duration_seconds_bucket{reporter=\\\"destination\\\",destination_workload=~\\\"$canary\\\",
    destination_workload_namespace=~\\\"$namespace\\\"}[1m])) by (le))\",\n          \"format\":
    \"time_series\",\n          \"interval\": \"\",\n          \"intervalFactor\": 1,\n
    \         \"legendFormat\": \"P50\",\n          \"refId\": \"A\"\n        },\n        {\n
    \         \"expr\": \"histogram_quantile(0.90, sum(irate(istio_request_duration_seconds_bucket{reporter=\\\"destination\\\",destination_workload=~\\\"$canary\\\",
    destination_workload_namespace=~\\\"$namespace\\\"}[1m])) by (le))\",\n          \"format\":
    \"time_series\",\n          \"hide\": false,\n          \"intervalFactor\": 1,\n
    \         \"legendFormat\": \"P90\",\n          \"refId\": \"B\"\n        },\n        {\n
    \         \"expr\": \"histogram_quantile(0.99, sum(irate(istio_request_duration_seconds_bucket{reporter=\\\"destination\\\",destination_workload=~\\\"$canary\\\",
    destination_workload_namespace=~\\\"$namespace\\\"}[1m])) by (le))\",\n          \"format\":
    \"time_series\",\n          \"hide\": false,\n          \"intervalFactor\": 1,\n
    \         \"legendFormat\": \"P99\",\n          \"refId\": \"C\"\n        }\n      ],\n
    \     \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n
    \     \"timeShift\": null,\n      \"title\": \"Canary: Request Duration\",\n      \"tooltip\":
    {\n        \"shared\": true,\n        \"sort\": 0,\n        \"value_type\": \"individual\"\n
    \     },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n
    \       \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n
    \       \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"format\":
    \"s\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\":
    null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n
    \         \"format\": \"short\",\n          \"label\": null,\n          \"logBase\":
    1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": false\n
    \       }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\":
    null\n      }\n    },\n    {\n      \"content\": \"<div class=\\\"dashboard-header
    text-center\\\">\\n<span>USE: $canary.$namespace</span>\\n</div>\",\n      \"gridPos\":
    {\n        \"h\": 3,\n        \"w\": 24,\n        \"x\": 0,\n        \"y\": 11\n
    \     },\n      \"id\": 101,\n      \"links\": [],\n      \"mode\": \"html\",\n
    \     \"title\": \"\",\n      \"transparent\": true,\n      \"type\": \"text\"\n
    \   },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\":
    10,\n      \"dashes\": false,\n      \"datasource\": \"prometheus\",\n      \"fill\":
    1,\n      \"gridPos\": {\n        \"h\": 6,\n        \"w\": 12,\n        \"x\":
    0,\n        \"y\": 14\n      },\n      \"id\": 100,\n      \"legend\": {\n        \"alignAsTable\":
    false,\n        \"avg\": false,\n        \"current\": false,\n        \"hideEmpty\":
    false,\n        \"hideZero\": false,\n        \"max\": false,\n        \"min\":
    false,\n        \"rightSide\": false,\n        \"show\": true,\n        \"total\":
    false,\n        \"values\": false\n      },\n      \"lines\": true,\n      \"linewidth\":
    1,\n      \"links\": [],\n      \"nullPointMode\": \"null\",\n      \"percentage\":
    false,\n      \"pointradius\": 5,\n      \"points\": false,\n      \"renderer\":
    \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\":
    true,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"expr\":
    \"sum(rate(container_cpu_usage_seconds_total{cpu=\\\"total\\\",namespace=\\\"$namespace\\\",pod_name=~\\\"$primary.*\\\",
    container_name!~\\\"POD|istio-proxy\\\"}[1m])) by (pod_name)\",\n          \"format\":
    \"time_series\",\n          \"hide\": false,\n          \"intervalFactor\": 1,\n
    \         \"legendFormat\": \"{{ pod_name }}\",\n          \"refId\": \"B\"\n        }\n
    \     ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\":
    [],\n      \"timeShift\": null,\n      \"title\": \"Primary: CPU Usage by Pod\",\n
    \     \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 0,\n        \"value_type\":
    \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\":
    null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n
    \       \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"format\":
    \"s\",\n          \"label\": \"CPU seconds / second\",\n          \"logBase\": 1,\n
    \         \"max\": null,\n          \"min\": null,\n          \"show\": true\n        },\n
    \       {\n          \"format\": \"short\",\n          \"label\": null,\n          \"logBase\":
    1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": false\n
    \       }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\":
    null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n
    \     \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": \"prometheus\",\n
    \     \"fill\": 1,\n      \"gridPos\": {\n        \"h\": 6,\n        \"w\": 12,\n
    \       \"x\": 12,\n        \"y\": 14\n      },\n      \"id\": 102,\n      \"legend\":
    {\n        \"alignAsTable\": false,\n        \"avg\": false,\n        \"current\":
    false,\n        \"hideEmpty\": false,\n        \"hideZero\": false,\n        \"max\":
    false,\n        \"min\": false,\n        \"rightSide\": false,\n        \"show\":
    true,\n        \"total\": false,\n        \"values\": false\n      },\n      \"lines\":
    true,\n      \"linewidth\": 1,\n      \"links\": [],\n      \"nullPointMode\": \"null\",\n
    \     \"percentage\": false,\n      \"pointradius\": 5,\n      \"points\": false,\n
    \     \"renderer\": \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\":
    10,\n      \"stack\": true,\n      \"steppedLine\": false,\n      \"targets\": [\n
    \       {\n          \"expr\": \"sum(rate(container_cpu_usage_seconds_total{cpu=\\\"total\\\",namespace=\\\"$namespace\\\",pod_name=~\\\"$canary.*\\\",
    pod_name!~\\\"$primary.*\\\", container_name!~\\\"POD|istio-proxy\\\"}[1m])) by
    (pod_name)\",\n          \"format\": \"time_series\",\n          \"hide\": false,\n
    \         \"intervalFactor\": 1,\n          \"legendFormat\": \"{{ pod_name }}\",\n
    \         \"refId\": \"B\"\n        }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\":
    null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n      \"title\":
    \"Canary: CPU Usage by Pod\",\n      \"tooltip\": {\n        \"shared\": true,\n
    \       \"sort\": 0,\n        \"value_type\": \"individual\"\n      },\n      \"type\":
    \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\": \"time\",\n
    \       \"name\": null,\n        \"show\": true,\n        \"values\": []\n      },\n
    \     \"yaxes\": [\n        {\n          \"format\": \"s\",\n          \"label\":
    \"CPU seconds / second\",\n          \"logBase\": 1,\n          \"max\": null,\n
    \         \"min\": null,\n          \"show\": true\n        },\n        {\n          \"format\":
    \"short\",\n          \"label\": null,\n          \"logBase\": 1,\n          \"max\":
    null,\n          \"min\": null,\n          \"show\": false\n        }\n      ],\n
    \     \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n
    \   },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\":
    10,\n      \"dashes\": false,\n      \"datasource\": \"prometheus\",\n      \"fill\":
    1,\n      \"gridPos\": {\n        \"h\": 6,\n        \"w\": 12,\n        \"x\":
    0,\n        \"y\": 20\n      },\n      \"id\": 103,\n      \"legend\": {\n        \"alignAsTable\":
    false,\n        \"avg\": false,\n        \"current\": false,\n        \"hideEmpty\":
    false,\n        \"hideZero\": false,\n        \"max\": false,\n        \"min\":
    false,\n        \"rightSide\": false,\n        \"show\": true,\n        \"total\":
    false,\n        \"values\": false\n      },\n      \"lines\": true,\n      \"linewidth\":
    1,\n      \"links\": [],\n      \"nullPointMode\": \"null\",\n      \"percentage\":
    false,\n      \"pointradius\": 5,\n      \"points\": false,\n      \"renderer\":
    \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\":
    true,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"expr\":
    \"sum(container_memory_working_set_bytes{namespace=\\\"$namespace\\\",pod_name=~\\\"$primary.*\\\",
    container_name!~\\\"POD|istio-proxy\\\"}) by (pod_name)\",\n          \"format\":
    \"time_series\",\n          \"hide\": false,\n          \"interval\": \"\",\n          \"intervalFactor\":
    1,\n          \"legendFormat\": \"{{ pod_name }}\",\n          \"refId\": \"B\"\n
    \       }\n      ],\n      \"thresholds\": [],\n      \"timeFrom\": null,\n      \"timeRegions\":
    [],\n      \"timeShift\": null,\n      \"title\": \"Primary: Memory Usage by Pod\",\n
    \     \"tooltip\": {\n        \"shared\": true,\n        \"sort\": 0,\n        \"value_type\":
    \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\":
    null,\n        \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n
    \       \"values\": []\n      },\n      \"yaxes\": [\n        {\n          \"decimals\":
    null,\n          \"format\": \"bytes\",\n          \"label\": \"\",\n          \"logBase\":
    1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": true\n
    \       },\n        {\n          \"format\": \"short\",\n          \"label\": null,\n
    \         \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n
    \         \"show\": false\n        }\n      ],\n      \"yaxis\": {\n        \"align\":
    false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\":
    {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n
    \     \"datasource\": \"prometheus\",\n      \"fill\": 1,\n      \"gridPos\": {\n
    \       \"h\": 6,\n        \"w\": 12,\n        \"x\": 12,\n        \"y\": 20\n      },\n
    \     \"id\": 104,\n      \"legend\": {\n        \"alignAsTable\": false,\n        \"avg\":
    false,\n        \"current\": false,\n        \"hideEmpty\": false,\n        \"hideZero\":
    false,\n        \"max\": false,\n        \"min\": false,\n        \"rightSide\":
    false,\n        \"show\": true,\n        \"total\": false,\n        \"values\":
    false\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"links\":
    [],\n      \"nullPointMode\": \"null\",\n      \"percentage\": false,\n      \"pointradius\":
    5,\n      \"points\": false,\n      \"renderer\": \"flot\",\n      \"seriesOverrides\":
    [],\n      \"spaceLength\": 10,\n      \"stack\": true,\n      \"steppedLine\":
    false,\n      \"targets\": [\n        {\n          \"expr\": \"sum(container_memory_working_set_bytes{namespace=\\\"$namespace\\\",pod_name=~\\\"$canary.*\\\",
    pod_name!~\\\"$primary.*\\\", container_name!~\\\"POD|istio-proxy\\\"}) by (pod_name)\",\n
    \         \"format\": \"time_series\",\n          \"hide\": false,\n          \"interval\":
    \"\",\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{ pod_name
    }}\",\n          \"refId\": \"B\"\n        }\n      ],\n      \"thresholds\": [],\n
    \     \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n
    \     \"title\": \"Canary: Memory Usage by Pod\",\n      \"tooltip\": {\n        \"shared\":
    true,\n        \"sort\": 0,\n        \"value_type\": \"individual\"\n      },\n
    \     \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\":
    \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\":
    []\n      },\n      \"yaxes\": [\n        {\n          \"decimals\": null,\n          \"format\":
    \"bytes\",\n          \"label\": \"\",\n          \"logBase\": 1,\n          \"max\":
    null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n
    \         \"format\": \"short\",\n          \"label\": null,\n          \"logBase\":
    1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": false\n
    \       }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\":
    null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n
    \     \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": \"prometheus\",\n
    \     \"fill\": 1,\n      \"gridPos\": {\n        \"h\": 6,\n        \"w\": 12,\n
    \       \"x\": 0,\n        \"y\": 26\n      },\n      \"id\": 105,\n      \"legend\":
    {\n        \"alignAsTable\": false,\n        \"avg\": false,\n        \"current\":
    false,\n        \"hideEmpty\": false,\n        \"hideZero\": false,\n        \"max\":
    false,\n        \"min\": false,\n        \"rightSide\": false,\n        \"show\":
    true,\n        \"total\": false,\n        \"values\": false\n      },\n      \"lines\":
    true,\n      \"linewidth\": 1,\n      \"links\": [],\n      \"nullPointMode\": \"null\",\n
    \     \"percentage\": false,\n      \"pointradius\": 5,\n      \"points\": false,\n
    \     \"renderer\": \"flot\",\n      \"seriesOverrides\": [\n        {\n          \"alias\":
    \"received\",\n          \"color\": \"#f9d9f9\"\n        },\n        {\n          \"alias\":
    \"transmited\",\n          \"color\": \"#f29191\"\n        }\n      ],\n      \"spaceLength\":
    10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\":
    [\n        {\n          \"expr\": \"sum(rate (container_network_receive_bytes_total{namespace=\\\"$namespace\\\",pod_name=~\\\"$primary.*\\\"}[1m]))
    \",\n          \"format\": \"time_series\",\n          \"intervalFactor\": 1,\n
    \         \"legendFormat\": \"received\",\n          \"refId\": \"A\"\n        },\n
    \       {\n          \"expr\": \"-sum (rate (container_network_transmit_bytes_total{namespace=\\\"$namespace\\\",pod_name=~\\\"$primary.*\\\"}[1m]))\",\n
    \         \"format\": \"time_series\",\n          \"intervalFactor\": 1,\n          \"legendFormat\":
    \"transmited\",\n          \"refId\": \"B\"\n        }\n      ],\n      \"thresholds\":
    [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\":
    null,\n      \"title\": \"Primary: Network I/O\",\n      \"tooltip\": {\n        \"shared\":
    true,\n        \"sort\": 0,\n        \"value_type\": \"individual\"\n      },\n
    \     \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\":
    \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\":
    []\n      },\n      \"yaxes\": [\n        {\n          \"decimals\": null,\n          \"format\":
    \"Bps\",\n          \"label\": \"\",\n          \"logBase\": 1,\n          \"max\":
    null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n
    \         \"format\": \"short\",\n          \"label\": null,\n          \"logBase\":
    1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": false\n
    \       }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\":
    null\n      }\n    },\n    {\n      \"aliasColors\": {},\n      \"bars\": false,\n
    \     \"dashLength\": 10,\n      \"dashes\": false,\n      \"datasource\": \"prometheus\",\n
    \     \"fill\": 1,\n      \"gridPos\": {\n        \"h\": 6,\n        \"w\": 12,\n
    \       \"x\": 12,\n        \"y\": 26\n      },\n      \"id\": 106,\n      \"legend\":
    {\n        \"alignAsTable\": false,\n        \"avg\": false,\n        \"current\":
    false,\n        \"hideEmpty\": false,\n        \"hideZero\": false,\n        \"max\":
    false,\n        \"min\": false,\n        \"rightSide\": false,\n        \"show\":
    true,\n        \"total\": false,\n        \"values\": false\n      },\n      \"lines\":
    true,\n      \"linewidth\": 1,\n      \"links\": [],\n      \"nullPointMode\": \"null\",\n
    \     \"percentage\": false,\n      \"pointradius\": 5,\n      \"points\": false,\n
    \     \"renderer\": \"flot\",\n      \"seriesOverrides\": [\n        {\n          \"alias\":
    \"received\",\n          \"color\": \"#f9d9f9\"\n        },\n        {\n          \"alias\":
    \"transmited\",\n          \"color\": \"#f29191\"\n        }\n      ],\n      \"spaceLength\":
    10,\n      \"stack\": false,\n      \"steppedLine\": false,\n      \"targets\":
    [\n        {\n          \"expr\": \"sum(rate (container_network_receive_bytes_total{namespace=\\\"$namespace\\\",pod_name=~\\\"$canary.*\\\",pod_name!~\\\"$primary.*\\\"}[1m]))
    \",\n          \"format\": \"time_series\",\n          \"intervalFactor\": 1,\n
    \         \"legendFormat\": \"received\",\n          \"refId\": \"A\"\n        },\n
    \       {\n          \"expr\": \"-sum (rate (container_network_transmit_bytes_total{namespace=\\\"$namespace\\\",pod_name=~\\\"$canary.*\\\",pod_name!~\\\"$primary.*\\\"}[1m]))\",\n
    \         \"format\": \"time_series\",\n          \"intervalFactor\": 1,\n          \"legendFormat\":
    \"transmited\",\n          \"refId\": \"B\"\n        }\n      ],\n      \"thresholds\":
    [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\":
    null,\n      \"title\": \"Canary: Network I/O\",\n      \"tooltip\": {\n        \"shared\":
    true,\n        \"sort\": 0,\n        \"value_type\": \"individual\"\n      },\n
    \     \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n        \"mode\":
    \"time\",\n        \"name\": null,\n        \"show\": true,\n        \"values\":
    []\n      },\n      \"yaxes\": [\n        {\n          \"decimals\": null,\n          \"format\":
    \"Bps\",\n          \"label\": \"\",\n          \"logBase\": 1,\n          \"max\":
    null,\n          \"min\": null,\n          \"show\": true\n        },\n        {\n
    \         \"format\": \"short\",\n          \"label\": null,\n          \"logBase\":
    1,\n          \"max\": null,\n          \"min\": null,\n          \"show\": false\n
    \       }\n      ],\n      \"yaxis\": {\n        \"align\": false,\n        \"alignLevel\":
    null\n      }\n    },\n    {\n      \"content\": \"<div class=\\\"dashboard-header
    text-center\\\">\\n<span>IN/OUTBOUND: $canary.$namespace</span>\\n</div>\",\n      \"gridPos\":
    {\n        \"h\": 3,\n        \"w\": 24,\n        \"x\": 0,\n        \"y\": 32\n
    \     },\n      \"id\": 45,\n      \"links\": [],\n      \"mode\": \"html\",\n      \"title\":
    \"\",\n      \"transparent\": true,\n      \"type\": \"text\"\n    },\n    {\n      \"aliasColors\":
    {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n
    \     \"datasource\": \"prometheus\",\n      \"fill\": 0,\n      \"gridPos\": {\n
    \       \"h\": 6,\n        \"w\": 12,\n        \"x\": 0,\n        \"y\": 35\n      },\n
    \     \"id\": 25,\n      \"legend\": {\n        \"avg\": false,\n        \"current\":
    false,\n        \"hideEmpty\": true,\n        \"max\": false,\n        \"min\":
    false,\n        \"show\": true,\n        \"total\": false,\n        \"values\":
    false\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"links\":
    [],\n      \"nullPointMode\": \"null as zero\",\n      \"percentage\": false,\n
    \     \"pointradius\": 5,\n      \"points\": false,\n      \"renderer\": \"flot\",\n
    \     \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n
    \     \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"expr\":
    \"round(sum(irate(istio_requests_total{connection_security_policy=\\\"mutual_tls\\\",
    destination_workload_namespace=~\\\"$namespace\\\", destination_workload=~\\\"$primary\\\",
    reporter=\\\"destination\\\"}[30s])) by (source_workload, source_workload_namespace,
    response_code), 0.001)\",\n          \"format\": \"time_series\",\n          \"hide\":
    false,\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{ source_workload
    }}.{{ source_workload_namespace }} : {{ response_code }} (\U0001F510mTLS)\",\n          \"refId\":
    \"B\",\n          \"step\": 2\n        },\n        {\n          \"expr\": \"round(sum(irate(istio_requests_total{connection_security_policy!=\\\"mutual_tls\\\",
    destination_workload_namespace=~\\\"$namespace\\\", destination_workload=~\\\"$primary\\\",
    reporter=\\\"destination\\\"}[30s])) by (source_workload, source_workload_namespace,
    response_code), 0.001)\",\n          \"format\": \"time_series\",\n          \"hide\":
    false,\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{ source_workload
    }}.{{ source_workload_namespace }} : {{ response_code }}\",\n          \"refId\":
    \"A\",\n          \"step\": 2\n        }\n      ],\n      \"thresholds\": [],\n
    \     \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n
    \     \"title\": \"Primary: Incoming Requests by Source And Response Code\",\n      \"tooltip\":
    {\n        \"shared\": false,\n        \"sort\": 0,\n        \"value_type\": \"individual\"\n
    \     },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n
    \       \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n
    \       \"values\": [\n          \"total\"\n        ]\n      },\n      \"yaxes\":
    [\n        {\n          \"format\": \"ops\",\n          \"label\": null,\n          \"logBase\":
    1,\n          \"max\": null,\n          \"min\": \"0\",\n          \"show\": true\n
    \       },\n        {\n          \"format\": \"short\",\n          \"label\": null,\n
    \         \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n
    \         \"show\": false\n        }\n      ],\n      \"yaxis\": {\n        \"align\":
    false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\":
    {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n
    \     \"datasource\": \"prometheus\",\n      \"fill\": 0,\n      \"gridPos\": {\n
    \       \"h\": 6,\n        \"w\": 12,\n        \"x\": 12,\n        \"y\": 35\n      },\n
    \     \"id\": 92,\n      \"legend\": {\n        \"avg\": false,\n        \"current\":
    false,\n        \"hideEmpty\": true,\n        \"max\": false,\n        \"min\":
    false,\n        \"show\": true,\n        \"total\": false,\n        \"values\":
    false\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"links\":
    [],\n      \"nullPointMode\": \"null as zero\",\n      \"percentage\": false,\n
    \     \"pointradius\": 5,\n      \"points\": false,\n      \"renderer\": \"flot\",\n
    \     \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n
    \     \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"expr\":
    \"round(sum(irate(istio_requests_total{connection_security_policy=\\\"mutual_tls\\\",
    destination_workload_namespace=~\\\"$namespace\\\", destination_workload=~\\\"$canary\\\",
    reporter=\\\"destination\\\"}[30s])) by (source_workload, source_workload_namespace,
    response_code), 0.001)\",\n          \"format\": \"time_series\",\n          \"hide\":
    false,\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{ source_workload
    }}.{{ source_workload_namespace }} : {{ response_code }} (\U0001F510mTLS)\",\n          \"refId\":
    \"B\",\n          \"step\": 2\n        },\n        {\n          \"expr\": \"round(sum(irate(istio_requests_total{connection_security_policy!=\\\"mutual_tls\\\",
    destination_workload_namespace=~\\\"$namespace\\\", destination_workload=~\\\"$canary\\\",
    reporter=\\\"destination\\\"}[30s])) by (source_workload, source_workload_namespace,
    response_code), 0.001)\",\n          \"format\": \"time_series\",\n          \"hide\":
    false,\n          \"intervalFactor\": 1,\n          \"legendFormat\": \"{{ source_workload
    }}.{{ source_workload_namespace }} : {{ response_code }}\",\n          \"refId\":
    \"A\",\n          \"step\": 2\n        }\n      ],\n      \"thresholds\": [],\n
    \     \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\": null,\n
    \     \"title\": \"Canary: Incoming Requests by Source And Response Code\",\n      \"tooltip\":
    {\n        \"shared\": false,\n        \"sort\": 0,\n        \"value_type\": \"individual\"\n
    \     },\n      \"type\": \"graph\",\n      \"xaxis\": {\n        \"buckets\": null,\n
    \       \"mode\": \"time\",\n        \"name\": null,\n        \"show\": true,\n
    \       \"values\": [\n          \"total\"\n        ]\n      },\n      \"yaxes\":
    [\n        {\n          \"format\": \"ops\",\n          \"label\": null,\n          \"logBase\":
    1,\n          \"max\": null,\n          \"min\": \"0\",\n          \"show\": true\n
    \       },\n        {\n          \"format\": \"short\",\n          \"label\": null,\n
    \         \"logBase\": 1,\n          \"max\": null,\n          \"min\": null,\n
    \         \"show\": false\n        }\n      ],\n      \"yaxis\": {\n        \"align\":
    false,\n        \"alignLevel\": null\n      }\n    },\n    {\n      \"aliasColors\":
    {},\n      \"bars\": false,\n      \"dashLength\": 10,\n      \"dashes\": false,\n
    \     \"datasource\": \"prometheus\",\n      \"fill\": 0,\n      \"gridPos\": {\n
    \       \"h\": 6,\n        \"w\": 12,\n        \"x\": 0,\n        \"y\": 41\n      },\n
    \     \"id\": 70,\n      \"legend\": {\n        \"avg\": false,\n        \"current\":
    false,\n        \"hideEmpty\": true,\n        \"max\": false,\n        \"min\":
    false,\n        \"show\": true,\n        \"total\": false,\n        \"values\":
    false\n      },\n      \"lines\": true,\n      \"linewidth\": 1,\n      \"links\":
    [],\n      \"nullPointMode\": \"null as zero\",\n      \"percentage\": false,\n
    \     \"pointradius\": 5,\n      \"points\": false,\n      \"renderer\": \"flot\",\n
    \     \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\": false,\n
    \     \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"expr\":
    \"round(sum(irate(istio_requests_total{connection_security_policy=\\\"mutual_tls\\\",
    source_workload_namespace=~\\\"$namespace\\\", source_workload=~\\\"$primary\\\",
    reporter=\\\"source\\\"}[30s])) by (destination_service, response_code), 0.001)\",\n
    \         \"format\": \"time_series\",\n          \"intervalFactor\": 1,\n          \"legendFormat\":
    \"{{ destination_service }} : {{ response_code }} (\U0001F510mTLS)\",\n          \"refId\":
    \"B\",\n          \"step\": 2\n        },\n        {\n          \"expr\": \"round(sum(irate(istio_requests_total{connection_security_policy!=\\\"mutual_tls\\\",
    source_workload_namespace=~\\\"$namespace\\\", source_workload=~\\\"$primary\\\",
    reporter=\\\"source\\\"}[30s])) by (destination_service, response_code), 0.001)\",\n
    \         \"format\": \"time_series\",\n          \"hide\": false,\n          \"intervalFactor\":
    1,\n          \"legendFormat\": \"{{ destination_service }} : {{ response_code }}\",\n
    \         \"refId\": \"A\",\n          \"step\": 2\n        }\n      ],\n      \"thresholds\":
    [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\":
    null,\n      \"title\": \"Primary: Outgoing Requests by Destination And Response
    Code\",\n      \"tooltip\": {\n        \"shared\": false,\n        \"sort\": 0,\n
    \       \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\":
    {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n
    \       \"show\": true,\n        \"values\": [\n          \"total\"\n        ]\n
    \     },\n      \"yaxes\": [\n        {\n          \"format\": \"ops\",\n          \"label\":
    null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": \"0\",\n
    \         \"show\": true\n        },\n        {\n          \"format\": \"short\",\n
    \         \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n
    \         \"min\": null,\n          \"show\": false\n        }\n      ],\n      \"yaxis\":
    {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    },\n    {\n
    \     \"aliasColors\": {},\n      \"bars\": false,\n      \"dashLength\": 10,\n
    \     \"dashes\": false,\n      \"datasource\": \"prometheus\",\n      \"fill\":
    0,\n      \"gridPos\": {\n        \"h\": 6,\n        \"w\": 12,\n        \"x\":
    12,\n        \"y\": 41\n      },\n      \"id\": 94,\n      \"legend\": {\n        \"avg\":
    false,\n        \"current\": false,\n        \"hideEmpty\": true,\n        \"max\":
    false,\n        \"min\": false,\n        \"show\": true,\n        \"total\": false,\n
    \       \"values\": false\n      },\n      \"lines\": true,\n      \"linewidth\":
    1,\n      \"links\": [],\n      \"nullPointMode\": \"null as zero\",\n      \"percentage\":
    false,\n      \"pointradius\": 5,\n      \"points\": false,\n      \"renderer\":
    \"flot\",\n      \"seriesOverrides\": [],\n      \"spaceLength\": 10,\n      \"stack\":
    false,\n      \"steppedLine\": false,\n      \"targets\": [\n        {\n          \"expr\":
    \"round(sum(irate(istio_requests_total{connection_security_policy=\\\"mutual_tls\\\",
    source_workload_namespace=~\\\"$namespace\\\", source_workload=~\\\"$canary\\\",
    reporter=\\\"source\\\"}[30s])) by (destination_service, response_code), 0.001)\",\n
    \         \"format\": \"time_series\",\n          \"intervalFactor\": 1,\n          \"legendFormat\":
    \"{{ destination_service }} : {{ response_code }} (\U0001F510mTLS)\",\n          \"refId\":
    \"B\",\n          \"step\": 2\n        },\n        {\n          \"expr\": \"round(sum(irate(istio_requests_total{connection_security_policy!=\\\"mutual_tls\\\",
    source_workload_namespace=~\\\"$namespace\\\", source_workload=~\\\"$canary\\\",
    reporter=\\\"source\\\"}[30s])) by (destination_service, response_code), 0.001)\",\n
    \         \"format\": \"time_series\",\n          \"hide\": false,\n          \"intervalFactor\":
    1,\n          \"legendFormat\": \"{{ destination_service }} : {{ response_code }}\",\n
    \         \"refId\": \"A\",\n          \"step\": 2\n        }\n      ],\n      \"thresholds\":
    [],\n      \"timeFrom\": null,\n      \"timeRegions\": [],\n      \"timeShift\":
    null,\n      \"title\": \"Canary: Outgoing Requests by Destination And Response
    Code\",\n      \"tooltip\": {\n        \"shared\": false,\n        \"sort\": 0,\n
    \       \"value_type\": \"individual\"\n      },\n      \"type\": \"graph\",\n      \"xaxis\":
    {\n        \"buckets\": null,\n        \"mode\": \"time\",\n        \"name\": null,\n
    \       \"show\": true,\n        \"values\": [\n          \"total\"\n        ]\n
    \     },\n      \"yaxes\": [\n        {\n          \"format\": \"ops\",\n          \"label\":
    null,\n          \"logBase\": 1,\n          \"max\": null,\n          \"min\": \"0\",\n
    \         \"show\": true\n        },\n        {\n          \"format\": \"short\",\n
    \         \"label\": null,\n          \"logBase\": 1,\n          \"max\": null,\n
    \         \"min\": null,\n          \"show\": false\n        }\n      ],\n      \"yaxis\":
    {\n        \"align\": false,\n        \"alignLevel\": null\n      }\n    }\n  ],\n
    \ \"refresh\": \"10s\",\n  \"schemaVersion\": 16,\n  \"style\": \"dark\",\n  \"tags\":
    [],\n  \"templating\": {\n    \"list\": [\n      {\n        \"allValue\": null,\n
    \       \"current\": null,\n        \"datasource\": \"prometheus\",\n        \"definition\":
    \"\",\n        \"hide\": 0,\n        \"includeAll\": false,\n        \"label\":
    \"Namespace\",\n        \"multi\": false,\n        \"name\": \"namespace\",\n        \"options\":
    [],\n        \"query\": \"query_result(sum(istio_requests_total) by (destination_workload_namespace)
    or sum(istio_tcp_sent_bytes_total) by (destination_workload_namespace))\",\n        \"refresh\":
    1,\n        \"regex\": \"/.*_namespace=\\\"([^\\\"]*).*/\",\n        \"skipUrlSync\":
    false,\n        \"sort\": 0,\n        \"tagValuesQuery\": \"\",\n        \"tags\":
    [],\n        \"tagsQuery\": \"\",\n        \"type\": \"query\",\n        \"useTags\":
    false\n      },\n      {\n        \"allValue\": null,\n        \"current\": null,\n
    \       \"datasource\": \"prometheus\",\n        \"definition\": \"\",\n        \"hide\":
    0,\n        \"includeAll\": false,\n        \"label\": \"Primary\",\n        \"multi\":
    false,\n        \"name\": \"primary\",\n        \"options\": [],\n        \"query\":
    \"query_result(sum(istio_requests_total{destination_workload_namespace=~\\\"$namespace\\\"})
    by (destination_workload))\",\n        \"refresh\": 1,\n        \"regex\": \"/.*destination_workload=\\\"([^\\\"]*).*/\",\n
    \       \"skipUrlSync\": false,\n        \"sort\": 1,\n        \"tagValuesQuery\":
    \"\",\n        \"tags\": [],\n        \"tagsQuery\": \"\",\n        \"type\": \"query\",\n
    \       \"useTags\": false\n      },\n      {\n        \"allValue\": null,\n        \"current\":
    null,\n        \"datasource\": \"prometheus\",\n        \"definition\": \"\",\n
    \       \"hide\": 0,\n        \"includeAll\": false,\n        \"label\": \"Canary\",\n
    \       \"multi\": false,\n        \"name\": \"canary\",\n        \"options\": [],\n
    \       \"query\": \"query_result(sum(istio_requests_total{destination_workload_namespace=~\\\"$namespace\\\"})
    by (destination_workload))\",\n        \"refresh\": 1,\n        \"regex\": \"/.*destination_workload=\\\"([^\\\"]*).*/\",\n
    \       \"skipUrlSync\": false,\n        \"sort\": 1,\n        \"tagValuesQuery\":
    \"\",\n        \"tags\": [],\n        \"tagsQuery\": \"\",\n        \"type\": \"query\",\n
    \       \"useTags\": false\n      }\n    ]\n  },\n  \"time\": {\n    \"from\": \"now-5m\",\n
    \   \"to\": \"now\"\n  },\n  \"timepicker\": {\n    \"refresh_intervals\": [\n      \"5s\",\n
    \     \"10s\",\n      \"30s\",\n      \"1m\",\n      \"5m\",\n      \"15m\",\n      \"30m\",\n
    \     \"1h\",\n      \"2h\",\n      \"1d\"\n    ],\n    \"time_options\": [\n      \"5m\",\n
    \     \"15m\",\n      \"1h\",\n      \"6h\",\n      \"12h\",\n      \"24h\",\n      \"2d\",\n
    \     \"7d\",\n      \"30d\"\n    ]\n  },\n  \"timezone\": \"\",\n  \"title\": \"Istio
    Canary\",\n  \"uid\": \"flagger-istio\",\n  \"version\": 3\n}"
---
# Source: grafana/templates/datasources-cfg.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-datasources
data:
  datasources.yaml: |-
    apiVersion: 1

    deleteDatasources:
      - name: prometheus
    datasources:
    - name: prometheus
      type: prometheus
      access: proxy
      url: http://flagger-prometheus:9090
      isDefault: true
      editable: true
      version: 1
---
# Source: grafana/templates/providers-cfg.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-providers
data:
  providers.yaml: |+
    apiVersion: 1

    providers:
    - name: 'default'
      orgId: 1
      folder: ''
      type: file
      disableDeletion: false
      editable: true
      options:
        path: /etc/grafana/dashboards
---
# Source: grafana/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: grafana
  labels:
    app: grafana
    chart: grafana-1.4.0
    release: grafana
    heritage: Helm
spec:
  type: ClusterIP
  ports:
    - port: 80
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app: grafana
    release: grafana
---
# Source: grafana/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: grafana
  labels:
    app: grafana
    chart: grafana-1.4.0
    release: grafana
    heritage: Helm
spec:
  replicas: 1
  selector:
    matchLabels:
      app: grafana
      release: grafana
  template:
    metadata:
      labels:
        app: grafana
        release: grafana
      annotations:
        prometheus.io/scrape: 'false'
    spec:
      containers:
        - name: grafana
          image: "grafana/grafana:6.5.1"
          imagePullPolicy: IfNotPresent
          ports:
            - name: http
              containerPort: 3000
              protocol: TCP
#          livenessProbe:
#            httpGet:
#              path: /
#              port: http
#          readinessProbe:
#            httpGet:
#              path: /
#              port: http
          env:
          - name: GF_PATHS_PROVISIONING
            value: /etc/grafana/provisioning/
          - name: GF_AUTH_BASIC_ENABLED
            value: "false"
          - name: GF_AUTH_ANONYMOUS_ENABLED
            value: "true"
          - name: GF_AUTH_ANONYMOUS_ORG_ROLE
            value: Admin
          volumeMounts:
          - name: grafana
            mountPath: /var/lib/grafana
          - name: dashboards
            mountPath: /etc/grafana/dashboards
          - name: datasources
            mountPath: /etc/grafana/provisioning/datasources
          - name: providers
            mountPath: /etc/grafana/provisioning/dashboards
          resources:
            {}
      volumes:
      - name: grafana
        emptyDir: {}
      - name: dashboards
        configMap:
          name: grafana-dashboards
      - name: providers
        configMap:
          name: grafana-providers
      - name: datasources
        configMap:
          name: grafana-datasources
